<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title> Brick Break CISC474</title>
        <<h1 align="center"
        >Brick Break CISC474</h1>
        <style>
            * {padding: 0; margin: 200; }
            canvas { background: #222222; display: block; margin: 0 auto; }
        </style>
    </head>

    <body>
        <canvas id="myCanvas" width="520" height="400"></canvas>

        <script>
            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");

            // Ball movement variables
            var xBall = canvas.width/2;
            var yBall = canvas.height-30;
            var xMove = 5;
            var yMove = -5;

            var ballRadius = 10;

            // Paddle
            var paddleHeight = 10;
            var paddleWidth = 75;
            var paddleX = (canvas.width - paddleWidth) / 2;
            var paddleOffset = 5;

            // Bricks
            var brickRows = 3;
            var brickCols = 5;
            var brickWidth = 75;
            var brickHeight = 20;
            var brickPadding = 10;
            var brickOffset= 50;

            var bricks = [];
            for (i = 0; i < brickCols; i++) {
                bricks[i] = [];
                for (j = 0; j < brickRows; j++) {
                    bricks[i][j] = { x: 0, y: 0};
                }
            }

            // User input initialization
            var leftPressed = false;
            var rightPressed = false;

            function drawBall() {
                ctx.beginPath();
                ctx.arc(xBall, yBall, ballRadius, 0, Math.PI*2);
                ctx.fillStyle = "#FF0000";
                ctx.fill();
                ctx.closePath();
            }
            
            function drawPaddle() {
                ctx.beginPath();
                ctx.rect(paddleX, canvas.height - paddleHeight - paddleOffset, paddleWidth, paddleHeight);
                ctx.fillStyle = "green";
                ctx.fill();
                ctx.closePath();
            }

            function drawBricks() {
                for (i = 0; i < brickCols; i++) {
                    for (j = 0; j < brickRows; j++) {
                        var brickX = (i * (brickWidth + brickPadding)) + brickOffset;
                        var brickY = (j * (brickHeight + brickPadding)) + brickOffset;
                        bricks[i][j].x = brickX;
                        bricks[i][j].y = brickY;
                        ctx.beginPath();
                        ctx.rect(brickX, brickY, brickWidth, brickHeight);
                        ctx.fillStyle = "#2040E1";
                        ctx.fill();
                        ctx.closePath();
                    }
                }
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBricks();
                drawPaddle();
                drawBall();
                brickCollision();
    
                // Keep ball in boundaries of screen
                if(yBall + yMove < ballRadius) { // Top of screen
                    yMove = -yMove;
                }
                else if(yBall + yMove > canvas.height - (paddleHeight + ballRadius + paddleOffset)) { // Ball height of top of paddle
                    if(xBall > paddleX && xBall < paddleX + paddleWidth) { // Ball within paddle x bounds
                        yMove = -yMove;
                    }
                    else if (xBall < paddleX || xBall > paddleX + paddleWidth) { // Ball outside of paddle x bounds, keeps moving until bottom of screen
                        yMove = yMove;
                        if(yBall + yMove > canvas.height) {
                            alert("Game Over");
                            document.location.reload();
                        }
                        
                    }
                    
                }
                if(xBall + xMove < ballRadius || xBall + xMove > canvas.width-ballRadius) { // Left and right of screen
                    xMove = -xMove
                }
                // Moves ball
                xBall += xMove;
                yBall += yMove;
                
                
                // Move Paddle
                if (rightPressed && paddleX < canvas.width - paddleWidth) {
                    paddleX += 7;
                }
                if (leftPressed && paddleX > 0) {
                    paddleX -= 7;
                }

            }

            document.addEventListener("keydown", keyDownHandler, false);
            document.addEventListener("keyup", keyUpHandler, false);

            // Handling user input
            function keyDownHandler(e) {
                if(e.keyCode == 39) {
                    rightPressed = true;
                }
                else if(e.keyCode == 37) {
                    leftPressed = true;
                }
            }

            function keyUpHandler(e) {
                if(e.keyCode == 39) {
                    rightPressed = false;
                }
                else if(e.keyCode == 37) {
                    leftPressed = false;
                }
            }
            console.log("adsf");
            function brickCollision() {
                console.log("HERE");
                for (i = 0; i < brickCols; i++) {
                    console.log(i);
                    for (j = 0; j < brickRows; j++) {
                        var brick = bricks[i][j];
                        if (xBall > brick.x && xBall < brick.x + brickWidth && yBall > brick.y && yBall < brick.y + brickHeight) {
                            yMove = -yMove;
                        }
                    }
                }
            }
            setInterval(draw, 10);




        </script>

    </body>
</html>